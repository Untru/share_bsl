# Введение
Приветствую всех! Давно зрела идея поделиться своим опытом в формате статьи. Что бы понять о чем эта статья, я думаю надо вначали озвучить мои цели.

## Мои цели
**Личная мотивация**

Хотел выйти за пределы привычной 1С, попробовать что-то новое, но с минимальным порогом входа. Выбор пал на OneScript и фреймворк Осень. После доклада Никиты узнал, что многие концепции заимствованы из Java — это стало отличным поводом изучить новые подходы, оставаясь в знакомой среде (без необходимости знать английский).

**Помощь сообществу**

В процессе изучения столкнулся с тем, что материалов по Осени не так много. Решил, что мой опыт может помочь другим, кто так же хочет разобраться, но сталкивается с трудностями.
И именно по этому решил что статья будет в формате "Мастер класс", так, на примерах сильно проще мне, а возможно и вам во всем этом разбираться.

<details>
 <summary> Кратко про oscript  </summary>


Это очень похожий язык на 1с, но есть несколько отличий.
На одном для понимания контекста хочется заострить внимание:

В OneScript есть классы. Проведу аналогию с 1С:
Более детально можно прочитать Тут и тут
Так как мне самому не сразу было понятно, что это, так как за спиной у меня только 1с, попробую объяснить на делетанском уровне:

Давайте возмем код на 1с. Работа с обработками:

```bsl
ОбработкаОбъект1 = Обработки.НашаОбработка.Создать();  
ОбработкаОбъект1.Имя = "Вася";  
ОбработкаОбъект2 = Обработки.НашаОбработка.Создать();  
ОбработкаОбъект2.Имя = "Петя"; 
```

Здесь мы создаем два экземпляра (инстанса) обработки. В OneScript классы работают похожим образом: мы их пишем, есть публичные/не публичные методы и свойства(аналогия обработкой 1с - реквизит), затем создаются экземпляры

```bsl
МойЭкземплярКласса1 = Новый Класс;
МойЭкземплярКласса1.Имя = "Вася";
МойЭкземплярКласса2 = Новый Класс;
МойЭкземплярКласса2.Имя = "Петя";
```
Зачем нужны классы? Если простыми словами, то они хранят какое то состояние.

Про оскрипт еще много что можно написать, но тогда ван не зватит на основную часть)
</details>

# Выбор проекта

Сложнее всего было определиться с идеей. Я работаю в франчайзи, и коллеги часто присылают обработки, расширения и т.д. Просматривать их с телефона неудобно, а оперативно проверять код — иногда необходимо. Это и породило идею создать механизм, с помощью которого я смогу быстро глянуть исходники и прокоментировать код.


**Решение:**

Создать Telegram-бота, в который кидаем бинарники а он их преобразует в читаемый код.

## Проблемы с которым я столкнулся:

**Проблема №1:** Как удобно просматривать код?

**Вариант 1:** Отправлять сырой текст в Telegram.
**Минусы:** нечитаемо, ограничение на 3000 символов.

**Вариант 2:** Использовать Paste1C. Замечательный сервис Paste 1c где изначально я все и реализовал.
**Минусы:** Что делать когда у обработки несколько форм и модуль объект, кидать много ссылок? Это не всегда удобно. особенно когда файлов много.

**Вариант 3:** Файлообменники.
**Минусы:** неудобно для быстрого просмотра.

Вариант 4: Gist GitHub.
Почему этот вариант мне понравился?
+ Позволяет сравнивать правки между версиями (как diff в 1С).
+ Есть доступ по ссылке (аналог Google Docs). Код виден только тем, кому вы дали ссылку.
**Минусы:** Тоже есть ограничения, вроде 100 файлов.

Вариант 5: Репозиторий.
**Минусы:** Нет возможности создавать доступ по ссылке, или всем видно или приватно с добавлением доступов

Итог: Я выбрал вариант 4 но надо сделать так что бы легко можно было расширить возможности и публиковать еще куда то.

Проблема 2 Архитектура приложения

Как мы все знаем, лушчий код писался во времена ут 10 и формирования печатных форм где метод длиной в киллометр.
Но мы попробуем обойти от него, паттернов и подходов к разработки приложений много, но давайте возмем за основу MVC
Попробуем разделить наде приложение на слои, что бы они были независимы.

ЧТо такое MVC - тут ссылка
Начнем с V - VIEW так как у нас телеграмм бот, то за вид у нас пусть он и отвечает.
С - Controller это наш мостик между отображением и бизнесс логикой
М - модел, тут работа с бд и бизнесс логика.

Я для себя решил что контроллеры это 




Кратко о OneScript (для понимания контекста)
В OneScript есть классы. Проведу аналогию с 1С:

bsl
ОбработкаОбъект1 = Обработки.НашаОбработка.Создать();  
ОбработкаОбъект1.Имя = "Вася";  
ОбработкаОбъект2 = Обработки.НашаОбработка.Создать();  
ОбработкаОбъект2.Имя = "Петя";  
Здесь мы создаем два экземпляра (инстанса) обработки. В OneScript классы работают похожим образом: сначала описывается структура, затем создаются экземпляры.

Задача: Telegram-бот
Как говорится, «хороший программист — ленивый программист», поэтому начал с поиска готовых библиотек. Нашел OPI (ссылка) — это значительно упростило работу.

Шаг 1: Создание и запуск приложения
Приведу пример кода для отправки сообщения в Telegram:

bsl
...  
Шаг 2: Обработка входящих сообщений
Первый наивный подход — «лесенка» из условий:

bsl
Если ТипСообщения = "Сообщение" Тогда  
    // Логика...  
ИначеЕсли ТипСообщения = "Файл" Тогда  
    // Логика...  
Иначе  
    // ...  
КонецЕсли;  
Но такой код сложно поддерживать. Решение нашлось в документации Осени:...